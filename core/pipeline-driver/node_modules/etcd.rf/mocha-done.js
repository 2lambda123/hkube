
let _doneCounter = 0;
let _options = null;
let _promise = null;
let callDone = () => {
    _doneCounter = _doneCounter + 1;
    if (_doneCounter >= _options.doneAmount) {
        _doneCounter = 0;
        _promise.resolve()

    }
    //  console.log(`callDone:${doneCounter}`);
}

let done = (options = { doneAmount: 1 }) => {
    _options = options;
    return new Promise((resolve, reject) => {
        _promise = { resolve, reject };
        // let intervalId = setInterval(() => {
        //     if (doneCounter >= options.doneAmount) {
        //         //isDone = false;
        //         doneCounter = 0;
        //         clearInterval(intervalId);
        //         resolve();
        //     }
        // }, options.millisecond);
    });


}


let semaphore = function semaphore() {

    this._promise = null;
    this._options = null;
    this._doneCounter = 0;
    this.callDone = () => {
        this._doneCounter = _doneCounter + 1;
        if (this._doneCounter >= this._options.doneAmount) {
            _doneCounter = 0;
            _promise.resolve()

        }
        //  console.log(`callDone:${doneCounter}`);
    }

    this.done = (options = { doneAmount: 1 }) => {
        _options = options;
        return new Promise((resolve, reject) => {
            _promise = { resolve, reject };
            // let intervalId = setInterval(() => {
            //     if (doneCounter >= options.doneAmount) {
            //         //isDone = false;
            //         doneCounter = 0;
            //         clearInterval(intervalId);
            //         resolve();
            //     }
            // }, options.millisecond);
        });


    }
}

module.exports = {
    callDone,
    done,
    semaphore
};