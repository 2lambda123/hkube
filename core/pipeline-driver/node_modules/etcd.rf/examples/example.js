let etcdDiscovery = new Etcd();
etcdDiscovery.init({
    etcd: {
        protocol: 'http',
        host: '127.0.0.1',
        port: 2379
    },
    serviceName: 'bla/bla'
}).then(() => {
    etcdDiscovery.register({
        ttl: 10,
        interval: 1000,
        instanceId: '12345',
        data: {
            bla: 'bla'
        }
    })
    setInterval(() => {
        etcdDiscovery.updateRegisteredData({ bla: 'bla' })
    }, 2000)

    etcdDiscovery.watch().then(etcd => {
        etcd.watcher.on('set', d => console.log(`set:    ${JSON.stringify(d)}`))
        etcd.watcher.on('change', d => console.log(`change: ${JSON.stringify(d)}`));
        etcd.watcher.on('expire', d => console.log(`expire: ${JSON.stringify(d)})`));
        etcd.watcher.on('delete', d => console.log(`delete: ${JSON.stringify(d)}`));
    });
    setTimeout(() => {
        console.log('---------------pause---------------------');
        etcdDiscovery.pause()
        console.log('------------------------------------');
    }, 5000);
    setTimeout(() => {
        console.log('---------------resume---------------------');
        etcdDiscovery.resume()
        console.log('------------------------------------');
    }, 10000);
    setTimeout(() => {
        console.log('----------------pause2--------------------');
        etcdDiscovery.pause()
        console.log('------------------------------------');
    }, 15000);
})
const etcdDiscovery2 = new Etcd();
etcdDiscovery2.init({
    etcd: {
        protocol: 'http',
        host: '127.0.0.1',
        port: 2379
    },
    serviceName: 'pipeline-driver/pipeline-driver-job:1046d36f-41fd-49a1-85c6-144fdf7d2129/workers'
}).then(() => {
    etcdDiscovery2.set({ data: { bla: 'bla' }, instanceId: 'vaad-1:12e09ec0-d112-463e-a238-2a83227d409e' })
        .then((res) => console.log(`saved - ${res} `));

    etcdDiscovery2.get({ instanceId: 'foo' })
        .then(res => console.log(`get result:ss ${res}`))
})



process.on('unhandledRejection', (reason, promise) => {

    console.log('------------------------------------');
    console.log(`reason - ${reason}`);
    console.dir(promise);
    console.log('------------------------------------');

});