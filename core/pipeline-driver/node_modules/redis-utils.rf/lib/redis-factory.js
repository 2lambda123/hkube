/*
 * Created by nassi on 24/03/16.
 */

var Redis = require("ioredis");

function RedisFactory() {
}

RedisFactory.prototype.getClient = function (options) {
    var client;
    if (!options.host){
        throw new Error('options missing redis host');
    }
    if (!options.port){
        throw new Error('options missing redis port');
    }
    if (options.sentinel) {
        //console.log('RedisFactory - connecting to redis-sentinel-service-host: ' + options.host);
        client = new Redis({
            sentinels: [{host: options.host, port: options.port}],
            name: options.masterName || 'mymaster',
            role: options.role || undefined //slave
        });
    }
    else {
        //console.log('RedisFactory - connecting to singleton redis-host: ' + options.host);
        client = new Redis({
            host: options.host,
            port: options.port
        });
    }
    return client;
};

module.exports = new RedisFactory();
